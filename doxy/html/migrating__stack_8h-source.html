<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>migrating_stack.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>migrating_stack.h</h1><div class="fragment"><pre>00001 <span class="comment">/***************************************************************************</span>
00002 <span class="comment"> *            migrating_stack.h</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Fri May  2 12:27:10 2003</span>
00005 <span class="comment"> *  Copyright  2003  Roman Dementiev</span>
00006 <span class="comment"> *  dementiev@mpi-sb.mpg.de</span>
00007 <span class="comment"> ****************************************************************************/</span>
00008 
00009 <span class="preprocessor">#include "stack.h"</span>
00010 <span class="preprocessor">#include &lt;stack&gt;</span>
00011 
00012 __STXXL_BEGIN_NAMESPACE
00013 
00015 
00023 <span class="keyword">template</span> &lt;
00024     <span class="keyword">typename</span> Tp_,
00025     <span class="keywordtype">unsigned</span> CriticalSize_,
00026                 <span class="keyword">typename</span> AllocStr_ = STXXL_DEFAULT_ALLOC_STRATEGY,
00027                 <span class="keywordtype">unsigned</span> BlkSize_ = STXXL_DEFAULT_BLOCK_SIZE (_Tp),
<a name="l00028"></a><a class="code" href="classstxxl_1_1migrating__stack.html">00028</a>                 <span class="keywordtype">unsigned</span> BlkCacheSize_ = 4 &gt;
00029 <span class="keyword">class </span><a class="code" href="classstxxl_1_1migrating__stack.html">migrating_stack</a>
00030 {
00031 <span class="keyword">public</span>:
00032   <span class="comment">// stl typedefs</span>
00033   <span class="keyword">typedef</span> Tp_ value_type;
00034   <span class="keyword">typedef</span> off_t size_type;
00035   
00036   <span class="keyword">typedef</span> std::stack&lt;value_type&gt; int_stack_type;
00037   <span class="keyword">typedef</span> stack&lt;Tp_,AllocStr_,BlkSize_,BlkCacheSize_&gt; ext_stack_type;
00038   
00039 <span class="keyword">private</span>:
00040   <span class="keyword">enum</span> { critical_size = CriticalSize_ };
00041     
00042   int_stack_type * int_impl;
00043   ext_stack_type * ext_impl;
00044 
00045 <span class="keyword">public</span>:
00046   <a class="code" href="classstxxl_1_1migrating__stack.html">migrating_stack</a>(): int_impl(<span class="keyword">new</span> int_stack_type()),ext_impl(NULL) {}
00048   <span class="keywordtype">bool</span> internal() 
00049   { 
00050     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00051     <span class="keywordflow">return</span> int_impl; 
00052   }
00054   <span class="keywordtype">bool</span> external() 
00055   {
00056     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00057     <span class="keywordflow">return</span> ext_impl; 
00058   }
00059   
00060   <span class="keywordtype">bool</span> empty()<span class="keyword"> const</span>
00061 <span class="keyword">  </span>{
00062     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00063     
00064     <span class="keywordflow">if</span>(int_impl)
00065       <span class="keywordflow">return</span> int_impl-&gt;empty();
00066     
00067     <span class="keywordflow">return</span> ext_impl-&gt;empty();
00068   }
00069   size_type size()<span class="keyword"> const</span>
00070 <span class="keyword">  </span>{
00071     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00072     
00073     <span class="keywordflow">if</span>(int_impl)
00074       <span class="keywordflow">return</span> int_impl-&gt;size();
00075     
00076     <span class="keywordflow">return</span> ext_impl-&gt;size();
00077   }
00078   value_type &amp; top()
00079   {
00080     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00081     
00082     <span class="keywordflow">if</span>(int_impl)
00083       <span class="keywordflow">return</span> int_impl-&gt;top();
00084     
00085     <span class="keywordflow">return</span> ext_impl-&gt;top();
00086   }
00087   <span class="keywordtype">void</span> push(<span class="keyword">const</span> value_type &amp; val)
00088   {
00089     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00090     
00091     <span class="keywordflow">if</span>(int_impl)
00092     {
00093       int_impl-&gt;push(val);
00094       <span class="keywordflow">if</span>(int_impl-&gt;size() == critical_size)
00095       {
00096         <span class="comment">// migrate to external stack</span>
00097         ext_impl = <span class="keyword">new</span> ext_stack_type(*int_impl);
00098         <span class="keyword">delete</span> int_impl;
00099         int_impl = NULL;
00100       }
00101     }
00102     <span class="keywordflow">else</span>
00103       ext_impl-&gt;push(val);
00104   }
00105   <span class="keywordtype">void</span> pop()
00106   {
00107     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00108     
00109     <span class="keywordflow">if</span>(int_impl)
00110       int_impl-&gt;pop();
00111     <span class="keywordflow">else</span>
00112       ext_impl-&gt;pop();
00113   }
00114   ~<a class="code" href="classstxxl_1_1migrating__stack.html">migrating_stack</a>()
00115   {
00116     assert((int_impl &amp;&amp; !ext_impl)||(!int_impl &amp;&amp; ext_impl));
00117     
00118     <span class="keywordflow">if</span>(int_impl)
00119       <span class="keyword">delete</span> int_impl;
00120     <span class="keywordflow">else</span>
00121       <span class="keyword">delete</span> ext_impl;
00122   }
00123 };
00124 
00125 __STXXL_END_NAMESPACE
</pre></div><hr><address style="align: right;"><small>Generated on Fri May 30 12:23:17 2003 for &lt;stxxl&gt; by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
