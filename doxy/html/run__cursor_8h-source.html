<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&lt;stxxl&gt;: run_cursor.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>run_cursor.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef RUN_CURSOR_HEADER</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define RUN_CURSOR_HEADER</span>
00003 <span class="preprocessor"></span>
00004 <span class="comment">/***************************************************************************</span>
00005 <span class="comment"> *            run_cursor.h</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *  Mon Jan 20 10:38:01 2003</span>
00008 <span class="comment"> *  Copyright  2003  Roman Dementiev</span>
00009 <span class="comment"> *  dementiev@mpi-sb.mpg.de</span>
00010 <span class="comment"> ****************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "../common/utils.h"</span>
00013 
00014 __STXXL_BEGIN_NAMESPACE
00015 
00016 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type&gt;
00017 <span class="keyword">struct </span>run_cursor
00018 {
00019         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos;
00020         block_type *buffer;
00021 
00022         <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">typename</span> block_type::type &amp; current ()<span class="keyword"> const</span>
00023 <span class="keyword">        </span>{
00024                 <span class="keywordflow">return</span> (*buffer)[pos];
00025         }
00026         <span class="keyword">inline</span> <span class="keywordtype">void</span> operator ++ (<span class="keywordtype">int</span>)
00027         {
00028                 pos++;
00029         }
00030 };
00031 
00032 <span class="preprocessor">#ifdef STXXL_SORT_SINGLE_PREFETCHER</span>
00033 <span class="preprocessor"></span>
00034 <span class="keyword">struct </span>have_prefetcher
00035 {
00036         <span class="keyword">static</span> <span class="keywordtype">void</span> * untyped_prefetcher;
00037 };
00038 
00039 <span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span>
00041 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type,
00042                                         <span class="keyword">typename</span> prefetcher_type_&gt;
00043 <span class="keyword">struct </span>run_cursor2:<span class="keyword">public</span> run_cursor&lt;block_type&gt;
00044 #ifdef STXXL_SORT_SINGLE_PREFETCHER
00045     ,<span class="keyword">public</span> have_prefetcher
00046 #endif
00047 {
00048         <span class="keyword">typedef</span> prefetcher_type_ prefetcher_type;
00049         <span class="keyword">typedef</span> run_cursor2&lt;block_type,prefetcher_type&gt; _Self;
00050         <span class="keyword">typedef</span> <span class="keyword">typename</span> block_type::value_type value_type;
00051                         
00052 <span class="preprocessor">#ifdef STXXL_SORT_SINGLE_PREFETCHER</span>
00053 <span class="preprocessor"></span>        <span class="keyword">static</span> prefetcher_type *&amp; prefetcher() <span class="comment">// sorry, a hack</span>
00054         {
00055                 <span class="keywordflow">return</span> (prefetcher_type * &amp;) untyped_prefetcher;
00056         }
00057   run_cursor2 () { }
00058 <span class="preprocessor">#else</span>
00059 <span class="preprocessor"></span>  prefetcher_type * prefetcher_;
00060   prefetcher_type *&amp; prefetcher() <span class="comment">// sorry, a hack</span>
00061         {
00062                 <span class="keywordflow">return</span> prefetcher_;
00063         }
00064   <span class="keyword">private</span>:
00065   run_cursor2();<span class="comment">// intentionally not defined to forbid default construction</span>
00066   <span class="keyword">public</span>:
00067   run_cursor2(prefetcher_type * p):prefetcher_(p) {}
00068 <span class="preprocessor">#endif</span>
00069 <span class="preprocessor"></span>        
00070         <span class="keyword">inline</span> <span class="keywordtype">bool</span> empty ()<span class="keyword"> const</span>
00071 <span class="keyword">        </span>{
00072                 <span class="keywordflow">return</span> (pos &gt;= block_type::size);
00073         };
00074         <span class="keyword">inline</span> <span class="keywordtype">void</span> operator ++ (<span class="keywordtype">int</span>);
00075         <span class="keyword">inline</span> <span class="keywordtype">void</span> make_inf ()
00076         {
00077                 pos = block_type::size;
00078         };
00079 };
00080 
00081 <span class="preprocessor">#ifdef STXXL_SORT_SINGLE_PREFETCHER</span>
00082 <span class="preprocessor"></span><span class="keywordtype">void</span> * have_prefetcher::untyped_prefetcher = NULL;
00083 <span class="preprocessor">#endif</span>
00084 <span class="preprocessor"></span>
00085 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type,
00086                                         <span class="keyword">typename</span> prefetcher_type&gt;
00087 <span class="keywordtype">void</span> run_cursor2&lt;block_type,prefetcher_type&gt;::operator ++ (<span class="keywordtype">int</span>)
00088 {
00089         pos++;
00090         <span class="keywordflow">if</span> (UNLIKELY(pos &gt;= block_type::size))
00091         {
00092                 <span class="keywordflow">if</span>( prefetcher()-&gt;block_consumed(buffer) ) pos = 0;
00093         }
00094 };
00095 
00096 
00097 
00098 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type&gt;
00099 <span class="keyword">struct </span>run_cursor_cmp
00100 {
00101         <span class="keyword">typedef</span> run_cursor&lt;block_type&gt; cursor_type;
00102         
00103         <span class="keyword">inline</span> <span class="keywordtype">bool</span> operator  () (<span class="keyword">const</span> cursor_type &amp; a, <span class="keyword">const</span> cursor_type &amp; b) <span class="comment">// greater or equal</span>
00104         {
00105                 <span class="keywordflow">return</span> !((*a.buffer)[a.pos] &lt; (*b.buffer)[b.pos]);
00106         };
00107 };
00108 
00109 __STXXL_END_NAMESPACE
00110 
00111 
00112 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Nov 26 10:56:53 2003 for <stxxl> by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
