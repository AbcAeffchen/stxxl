<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>run_cursor.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>run_cursor.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef RUN_CURSOR_HEADER</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define RUN_CURSOR_HEADER</span>
00003 <span class="preprocessor"></span>
00004 <span class="comment">/***************************************************************************</span>
00005 <span class="comment"> *            run_cursor.h</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *  Mon Jan 20 10:38:01 2003</span>
00008 <span class="comment"> *  Copyright  2003  Roman Dementiev</span>
00009 <span class="comment"> *  dementiev@mpi-sb.mpg.de</span>
00010 <span class="comment"> ****************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "../common/utils.h"</span>
00013 
00014 __STXXL_BEGIN_NAMESPACE
00015 
00016 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type&gt;
00017 <span class="keyword">struct </span>run_cursor
00018 {
00019         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos;
00020         block_type *buffer;
00021 
00022         <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">typename</span> block_type::type &amp; current ()<span class="keyword"> const</span>
00023 <span class="keyword">        </span>{
00024                 <span class="keywordflow">return</span> (*buffer)[pos];
00025         }
00026         <span class="keyword">inline</span> <span class="keywordtype">void</span> operator ++ (<span class="keywordtype">int</span>)
00027         {
00028                 pos++;
00029         }
00030 };
00031 
00032 
00033 <span class="keyword">struct </span>have_prefetcher
00034 {
00035         <span class="keyword">static</span> <span class="keywordtype">void</span> * untyped_prefetcher;
00036 };
00037 
00038 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type,
00039                                         <span class="keyword">typename</span> prefetcher_type_&gt;
00040 <span class="keyword">struct </span>run_cursor2:<span class="keyword">public</span> run_cursor&lt;block_type&gt;,<span class="keyword">public</span> have_prefetcher
00041 {
00042         <span class="keyword">typedef</span> prefetcher_type_ prefetcher_type;
00043         <span class="keyword">typedef</span> run_cursor2&lt;block_type,prefetcher_type&gt; _Self;
00044         <span class="keyword">typedef</span> <span class="keyword">typename</span> block_type::value_type value_type;
00045                                                                                         
00046         <span class="keyword">static</span> prefetcher_type *&amp; prefetcher() <span class="comment">// sorry, a hack</span>
00047         {
00048                 <span class="keywordflow">return</span> (prefetcher_type * &amp;) untyped_prefetcher;
00049         };
00050         
00051         run_cursor2 () { };
00052         
00053         <span class="keyword">inline</span> <span class="keywordtype">bool</span> empty ()<span class="keyword"> const</span>
00054 <span class="keyword">        </span>{
00055                 <span class="keywordflow">return</span> (pos &gt;= block_type::size);
00056         };
00057         <span class="keyword">inline</span> <span class="keywordtype">void</span> operator ++ (<span class="keywordtype">int</span>);
00058         <span class="keyword">inline</span> <span class="keywordtype">void</span> make_inf ()
00059         {
00060                 pos = block_type::size;
00061         };
00062 };
00063 
00064 <span class="keywordtype">void</span> * have_prefetcher::untyped_prefetcher = NULL;
00065 
00066 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type,
00067                                         <span class="keyword">typename</span> prefetcher_type&gt;
00068 <span class="keywordtype">void</span>
00069 run_cursor2&lt;block_type,prefetcher_type&gt;::operator ++ (<span class="keywordtype">int</span>)
00070 {
00071         pos++;
00072         <span class="keywordflow">if</span> (UNLIKELY(pos &gt;= block_type::size))
00073         {
00074                 <span class="keywordflow">if</span>( prefetcher()-&gt;block_consumed(buffer) ) pos = 0;
00075         }
00076 };
00077 
00078 
00079 
00080 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> block_type&gt;
00081 <span class="keyword">struct </span>run_cursor_cmp
00082 {
00083         <span class="keyword">typedef</span> run_cursor&lt;block_type&gt; cursor_type;
00084         
00085         <span class="keyword">inline</span> <span class="keywordtype">bool</span> operator  () (<span class="keyword">const</span> cursor_type &amp; a, <span class="keyword">const</span> cursor_type &amp; b) <span class="comment">// greater or equal</span>
00086         {
00087                 <span class="keywordflow">return</span> !((*a.buffer)[a.pos] &lt; (*b.buffer)[b.pos]);
00088         };
00089 };
00090 
00091 __STXXL_END_NAMESPACE
00092 
00093 
00094 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue Jul 1 11:08:36 2003 for &lt;stxxl&gt; by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
