<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&lt;stxxl&gt;: adaptor.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>adaptor.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef ALGO_ADAPTOR_HEADER</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define ALGO_ADAPTOR_HEADER</span>
00003 <span class="preprocessor"></span><span class="comment">/***************************************************************************</span>
00004 <span class="comment"> *            adaptor.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *  Fri Oct  4 23:28:04 2002</span>
00007 <span class="comment"> *  Copyright  2002  Roman Dementiev</span>
00008 <span class="comment"> *  dementiev@mpi-sb.mpg.de</span>
00009 <span class="comment"> ****************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "../mng/mng.h"</span>
00012 <span class="preprocessor">#include "../mng/adaptor.h"</span>
00013 <span class="preprocessor">#include "../common/utils.h"</span>
00014 
00015 
00016 __STXXL_BEGIN_NAMESPACE
00017 
00018 <span class="keyword">template</span> &lt; <span class="keywordtype">unsigned</span> _blk_sz, <span class="keyword">typename</span> _run_type, <span class="keyword">class</span> __pos_type = <span class="keywordtype">int</span> &gt;
00019 <span class="keyword">struct </span>RunsToBIDArrayAdaptor: <span class="keyword">public</span> TwoToOneDimArrayAdaptorBase &lt; _run_type *, BID &lt; _blk_sz &gt; , __pos_type &gt;
00020 {
00021         <span class="keyword">typedef</span> RunsToBIDArrayAdaptor &lt; _blk_sz, _run_type,__pos_type &gt; _Self;
00022         <span class="keyword">typedef</span> BID &lt; _blk_sz &gt; data_type;
00023 
00024         <span class="keyword">enum</span>    { block_size = _blk_sz };
00025 
00026         <span class="keywordtype">unsigned</span> dim_size;
00027 
00028           RunsToBIDArrayAdaptor (_run_type * *a, __pos_type p,
00029                                  <span class="keywordtype">unsigned</span> d):TwoToOneDimArrayAdaptorBase &lt;
00030                 _run_type *, BID &lt; _blk_sz &gt;, __pos_type &gt; (a, p), dim_size (d)
00031         {
00032         };
00033         RunsToBIDArrayAdaptor (<span class="keyword">const</span> _Self &amp; a):TwoToOneDimArrayAdaptorBase &lt;
00034                 _run_type *, BID &lt; _blk_sz &gt;, __pos_type &gt; (a),
00035                 dim_size (a.dim_size)
00036         {
00037         };
00038 
00039         <span class="keyword">const</span> _Self &amp; operator = (<span class="keyword">const</span> _Self &amp; a)
00040         {
00041                 array = a.array;
00042                 pos = a.pos;
00043                 dim_size = a.dim_size;
00044                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00045         }
00046 
00047         data_type &amp; operator * ()
00048         {
00049                 CHECK_RUN_BOUNDS (pos)
00050                         <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00051                                 &amp;)((*(array[(pos) % dim_size]))[(pos) /
00052                                                                 dim_size].
00053                                    bid);
00054         };
00055 
00056         <span class="keyword">const</span> data_type *operator -&gt; ()<span class="keyword"> const</span>
00057 <span class="keyword">        </span>{
00058                 CHECK_RUN_BOUNDS (pos)
00059                         <span class="keywordflow">return</span>
00060                         &amp;((*(array[(pos) % dim_size])[(pos) / dim_size].bid));
00061         };
00062 
00063 
00064         data_type &amp; operator [](__pos_type n)<span class="keyword"> const</span>
00065 <span class="keyword">        </span>{
00066                 n += pos;
00067                 CHECK_RUN_BOUNDS (n)
00068                         <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00069                                 &amp;) ((*(array[(n) % dim_size]))[(n) /
00070                                                                dim_size].bid);
00071         };
00072 
00073 };
00074 
00075      BLOCK_ADAPTOR_OPERATORS(RunsToBIDArrayAdaptor) 
00076 
00077 <span class="keyword">template</span> &lt; <span class="keywordtype">unsigned</span>
00078      _blk_sz,<span class="keyword">typename</span> _run_type, <span class="keyword">class </span>__pos_type =
00079              <span class="keywordtype">int</span> &gt;<span class="keyword">struct </span>RunsToBIDArrayAdaptor2:<span class="keyword">public</span>
00080              TwoToOneDimArrayAdaptorBase &lt; _run_type *, BID &lt; _blk_sz &gt;,
00081              __pos_type &gt;
00082      {
00083              <span class="keyword">typedef</span> RunsToBIDArrayAdaptor2 &lt; _blk_sz, _run_type,__pos_type &gt; _Self;
00084              <span class="keyword">typedef</span> BID &lt; _blk_sz &gt; data_type;
00085 
00086              <span class="keyword">enum</span>
00087              { block_size = _blk_sz };
00088 
00089              __pos_type w, h, K;
00090 
00091                RunsToBIDArrayAdaptor2 (_run_type * *a, __pos_type p, <span class="keywordtype">int</span> _w,
00092                                        <span class="keywordtype">int</span> _h):TwoToOneDimArrayAdaptorBase &lt;
00093                      _run_type *, BID &lt; _blk_sz &gt;, __pos_type &gt; (a, p), w (_w),
00094                      h (_h), K (_w * _h)
00095              {
00096              };
00097 
00098              RunsToBIDArrayAdaptor2 (<span class="keyword">const</span> _Self &amp;
00099                                      a):TwoToOneDimArrayAdaptorBase &lt; _run_type *,
00100                      BID &lt; _blk_sz &gt;, __pos_type &gt; (a), w (a.w), h (a.h),
00101                      K (a.K)
00102              {
00103              };
00104 
00105              <span class="keyword">const</span> _Self &amp; operator = (<span class="keyword">const</span> _Self &amp; a)
00106              {
00107                      array = a.array;
00108                      pos = a.pos;
00109                      w = a.w;
00110                      h = a.h;
00111                      K = a.K;
00112                      <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00113              }
00114 
00115              data_type &amp; operator * ()
00116              {
00117                      <span class="keyword">register</span> __pos_type i = pos - K;
00118                      <span class="keywordflow">if</span> (i &lt; 0)
00119                              <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00120                                      &amp;)((*(array[(pos) % w]))[(pos) / w].bid);
00121 
00122                      <span class="keyword">register</span> __pos_type _w = w;
00123                      _w--;
00124                      <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00125                              &amp;)((*(array[(i) % _w]))[h + (i / _w)].bid);
00126 
00127              };
00128 
00129              <span class="keyword">const</span> data_type *operator -&gt; ()<span class="keyword"> const</span>
00130 <span class="keyword">             </span>{
00131                      <span class="keyword">register</span> __pos_type i = pos - K;
00132                      <span class="keywordflow">if</span> (i &lt; 0)
00133                                <span class="keywordflow">return</span> &amp;((*(array[(pos) % w])[(pos) / w].bid));
00134 
00135                      <span class="keyword">register</span> __pos_type _w = w;
00136                        _w--;
00137                        <span class="keywordflow">return</span> &amp;((*(array[(i) % _w])[h + (i / _w)].bid));
00138              };
00139 
00140 
00141              data_type &amp; operator [](__pos_type n)<span class="keyword"> const</span>
00142 <span class="keyword">             </span>{
00143                      n += pos;
00144                      <span class="keyword">register</span> __pos_type i = n - K;
00145                      <span class="keywordflow">if</span> (i &lt; 0)
00146                                <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00147                                        &amp;) ((*(array[(n) % w]))[(n) / w].bid);
00148 
00149                      <span class="keyword">register</span> __pos_type _w = w;
00150                        _w--;
00151                        <span class="keywordflow">return</span> (BID &lt; _blk_sz &gt;
00152                                &amp;) ((*(array[(i) % _w]))[h + (i / _w)].bid);
00153              };
00154        
00155 
00156      };
00157 
00158   BLOCK_ADAPTOR_OPERATORS (RunsToBIDArrayAdaptor2)
00159 
00160                  
00161         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> trigger_iterator_type,<span class="keywordtype">unsigned</span> _BlkSz&gt;
00162         <span class="keyword">struct </span>trigger_entry_iterator
00163         {
00164                 <span class="keyword">typedef</span> trigger_entry_iterator&lt;trigger_iterator_type,_BlkSz&gt; _Self;
00165                 
00166                 <span class="keyword">typedef</span> BID&lt;_BlkSz&gt; bid_type;
00167                 trigger_iterator_type value;
00168                 
00169                 <span class="keyword">enum</span> { block_size = _BlkSz };
00170                 
00171                 trigger_entry_iterator(<span class="keyword">const</span> _Self &amp; a):value(a.value) {};
00172                 trigger_entry_iterator(trigger_iterator_type v):value(v) {};
00173         
00174                 bid_type &amp; operator * ()
00175                 {
00176                         <span class="keywordflow">return</span> value-&gt;bid;
00177                 }
00178                 bid_type * operator -&gt; ()<span class="keyword"> const</span>
00179 <span class="keyword">                </span>{
00180                         <span class="keywordflow">return</span> &amp;(value-&gt;bid);
00181                 }
00182                 <span class="keyword">const</span> bid_type &amp; operator [] (<span class="keywordtype">int</span> n)<span class="keyword"> const</span>
00183 <span class="keyword">                </span>{
00184                         <span class="keywordflow">return</span> (value + n)-&gt;bid;
00185                 }
00186                 bid_type &amp; operator [] (<span class="keywordtype">int</span> n)
00187                 {
00188                         <span class="keywordflow">return</span> (value + n)-&gt;bid;
00189                 }
00190     
00191                 _Self &amp; operator ++()
00192                 {
00193                         value++;
00194                         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00195                 }
00196                 _Self operator ++(<span class="keywordtype">int</span>)
00197                 {
00198                         _Self __tmp = *<span class="keyword">this</span>;
00199                         value++;
00200                         <span class="keywordflow">return</span> __tmp;
00201                 }
00202                 _Self &amp; operator --()
00203                 {
00204                         value--;
00205                         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00206                 }
00207                 _Self operator --(<span class="keywordtype">int</span>)
00208                 {
00209                         _Self __tmp = *<span class="keyword">this</span>;
00210                         value--;
00211                         <span class="keywordflow">return</span> __tmp;
00212                 }
00213                 <span class="keywordtype">bool</span> operator == (<span class="keyword">const</span> _Self &amp;a)<span class="keyword"> const</span>
00214 <span class="keyword">                </span>{
00215                         <span class="keywordflow">return</span> value == a.value;
00216                 }
00217                 <span class="keywordtype">bool</span> operator != (<span class="keyword">const</span> _Self &amp;a)<span class="keyword"> const</span>
00218 <span class="keyword">                </span>{
00219                         <span class="keywordflow">return</span> value != a.value;        
00220                 }       
00221                 _Self operator += (<span class="keywordtype">int</span> n)
00222                 {
00223                         value += n;
00224                         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00225                 }
00226                 _Self operator -= (<span class="keywordtype">int</span> n)
00227                 {
00228                         value -= n;
00229                         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00230                 }
00231                 <span class="keywordtype">int</span> operator - (<span class="keyword">const</span> _Self &amp; a)<span class="keyword"> const</span>
00232 <span class="keyword">                </span>{
00233                         <span class="keywordflow">return</span> value - a.value;
00234                 }
00235                 <span class="keywordtype">int</span> operator + (<span class="keyword">const</span> _Self &amp; a)<span class="keyword"> const</span>
00236 <span class="keyword">                </span>{
00237                         <span class="keywordflow">return</span> value + a.value;
00238                 }
00239         };
00240                  
00241                  
00242                  
00243 __STXXL_END_NAMESPACE
00244 
00245 <span class="preprocessor">#endif</span>
00246 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Nov 26 10:56:51 2003 for <stxxl> by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
