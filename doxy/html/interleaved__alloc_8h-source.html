<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>interleaved_alloc.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>interleaved_alloc.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef INTERLEAVED_ALLOC_HEADER</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define INTERLEAVED_ALLOC_HEADER</span>
00003 <span class="preprocessor"></span><span class="comment">/***************************************************************************</span>
00004 <span class="comment"> *            interleaved_alloc.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *  Fri Oct  4 23:14:44 2002</span>
00007 <span class="comment"> *  Copyright  2002  Roman Dementiev</span>
00008 <span class="comment"> *  dementiev@mpi-sb.mpg.de</span>
00009 <span class="comment"> ****************************************************************************/</span>
00010 <span class="preprocessor">#include "../mng/mng.h"</span>
00011 <span class="preprocessor">#include "../common/rand.h"</span>
00012 <span class="preprocessor">#include &lt;vector&gt;</span>
00013 
00014 
00015 __STXXL_BEGIN_NAMESPACE
00016 
00017 <span class="preprocessor">#define CHECK_RUN_BOUNDS(pos)</span>
00018 <span class="preprocessor"></span>
00019 <span class="keyword">struct </span>interleaved_striping
00020 {
00021         <span class="keywordtype">int</span> nruns, begindisk, diff;
00022           interleaved_striping (<span class="keywordtype">int</span> _nruns, <span class="keywordtype">int</span> _begindisk,
00023                                <span class="keywordtype">int</span> _enddisk):nruns (_nruns),
00024                 begindisk (_begindisk), diff (_enddisk - _begindisk)
00025         {
00026         };
00027 
00028         <span class="keywordtype">int</span> operator () (<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00029 <span class="keyword">        </span>{
00030                 <span class="keywordflow">return</span> begindisk + (i / nruns) % diff;
00031         };
00032 };
00033 
00034 <span class="keyword">struct </span>interleaved_FR:<span class="keyword">public</span> interleaved_striping
00035 {
00036         interleaved_FR (<span class="keywordtype">int</span> _nruns, <span class="keywordtype">int</span> _begindisk,
00037                        <span class="keywordtype">int</span> _enddisk):interleaved_striping (_nruns, _begindisk,
00038                                                           _enddisk)
00039         {
00040         };
00041         random_number&lt;random_uniform_fast&gt; rnd;
00042         <span class="keywordtype">int</span> operator () (<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00043 <span class="keyword">        </span>{
00044                 <span class="keywordflow">return</span> begindisk + rnd(diff);
00045         };
00046 };
00047 
00048 <span class="keyword">struct </span>interleaved_SR:<span class="keyword">public</span> interleaved_striping
00049 {
00050         std::vector &lt; int &gt;offsets;
00051 
00052           interleaved_SR (<span class="keywordtype">int</span> _nruns, <span class="keywordtype">int</span> _begindisk,
00053                          <span class="keywordtype">int</span> _enddisk):interleaved_striping (_nruns,
00054                                                             _begindisk,
00055                                                             _enddisk)
00056         {
00057                 random_number&lt;random_uniform_fast&gt; rnd;
00058                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nruns; i++)
00059                         offsets.push_back(rnd(diff));
00060         };
00061 
00062         <span class="keywordtype">int</span> operator () (<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00063 <span class="keyword">        </span>{
00064                 <span class="keywordflow">return</span> begindisk + (i / nruns + offsets[i % nruns]) % diff;
00065         };
00066 };
00067 
00068 
00069 
00070 <span class="keyword">struct </span>interleaved_RC:<span class="keyword">public</span> interleaved_striping
00071 {
00072         std::vector &lt; std::vector &lt; int &gt; &gt; perms;
00073 
00074           interleaved_RC (<span class="keywordtype">int</span> _nruns, <span class="keywordtype">int</span> _begindisk,
00075                          <span class="keywordtype">int</span> _enddisk):interleaved_striping (_nruns,
00076                                                             _begindisk,
00077                                                             _enddisk),
00078                 perms (nruns, std::vector &lt; int &gt;(diff))
00079         {
00080                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nruns; i++)
00081                 {
00082                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; diff; j++)
00083                                 perms[i][j] = j;
00084 
00085                         random_number&lt;random_uniform_fast&gt; rnd;
00086                         std::random_shuffle (perms[i].begin (),
00087                                              perms[i].end (), rnd);
00088                 }
00089         };
00090 
00091         <span class="keywordtype">int</span> operator () (<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00092 <span class="keyword">        </span>{
00093                 <span class="keywordflow">return</span> begindisk + perms[i % nruns][(i / nruns) % diff];
00094         };
00095 };
00096 
00097 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> scheme&gt;
00098 <span class="keyword">struct </span>interleaved_alloc_traits
00099 {
00100 };
00101 
00102 <span class="keyword">template</span> &lt;&gt;
00103 <span class="keyword">struct </span>interleaved_alloc_traits&lt;striping&gt;
00104 {
00105         <span class="keyword">typedef</span> interleaved_striping strategy;
00106 };
00107 
00108 <span class="keyword">template</span> &lt;&gt;
00109 <span class="keyword">struct </span>interleaved_alloc_traits&lt;FR&gt;
00110 {
00111         <span class="keyword">typedef</span> interleaved_FR strategy;
00112 };
00113 
00114 <span class="keyword">template</span> &lt;&gt;
00115 <span class="keyword">struct </span>interleaved_alloc_traits&lt;SR&gt;
00116 {
00117         <span class="keyword">typedef</span> interleaved_SR strategy;
00118 };
00119 
00120 <span class="keyword">template</span> &lt;&gt;
00121 <span class="keyword">struct </span>interleaved_alloc_traits&lt;RC&gt;
00122 {
00123         <span class="keyword">typedef</span> interleaved_RC strategy;
00124 };
00125 
00126 __STXXL_END_NAMESPACE
00127 
00128 <span class="preprocessor">#endif</span>
00129 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue Jul 1 11:08:34 2003 for &lt;stxxl&gt; by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
